<?xml version="1.0" encoding="utf-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Issues.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=2;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Jacoco Coverage Report</a> &gt; <a href="index.source.html" class="el_package">model</a> &gt; <span class="el_source">Issues.java</span></div><h1>Issues.java</h1><pre class="source lang-java linenums">package model;

import javax.inject.Inject;

import com.fasterxml.jackson.databind.JsonNode;
import play.mvc.*;
import play.libs.ws.*;

import java.util.*;
import java.util.concurrent.CompletionStage;
import java.util.stream.Collectors;
import java.util.stream.Stream;
import java.util.stream.StreamSupport;

import static play.mvc.Results.ok;


public class Issues implements WSBodyReadables, WSBodyWritables{

    private final WSClient ws;
<span class="nc" id="L21">    private static HashMap&lt;String, Integer&gt; wordCount = new HashMap&lt;&gt;();</span>

    @Inject
<span class="nc" id="L24">    public Issues(WSClient ws){</span>
<span class="nc" id="L25">        this.ws = ws;</span>
<span class="nc" id="L26">    }</span>

    public CompletionStage&lt;Result&gt; getIssues(){

<span class="nc" id="L30">        WSRequest request = ws.url(&quot;https://api.github.com/repos/octocat/hello-world/issues&quot;)</span>
<span class="nc" id="L31">                .addHeader(&quot;Accept&quot;, &quot;application/vnd.github.v3+json&quot;);</span>

<span class="nc" id="L33">        CompletionStage&lt;WSResponse&gt; response = request.get();</span>

<span class="nc" id="L35">        CompletionStage&lt;JsonNode&gt; nodes = response.thenApply(WSResponse::asJson);</span>

<span class="nc" id="L37">        CompletionStage&lt;List&lt;String&gt;&gt; listOfTitles = nodes</span>
<span class="nc" id="L38">                .thenApply(jsonNode -&gt; StreamSupport.stream(jsonNode.spliterator(), false)</span>
                        .map(node -&gt; node.get(&quot;title&quot;))
                        .map(JsonNode::toString)
                        .collect(Collectors.toList()));

<span class="nc" id="L43">        uniqueDescending(listOfTitles);</span>
<span class="nc" id="L44">        return listOfTitles.thenApply(titles -&gt; ok(views.html.issue.render(titles, sortWordCount())));</span>
    }

    private void uniqueDescending(CompletionStage&lt;List&lt;String&gt;&gt; listOfTitles){

<span class="nc" id="L49">        CompletionStage&lt;Stream&lt;String&gt;&gt; stringStream = listOfTitles.thenApply(</span>
                titles -&gt; titles.stream()
                        .map(title -&gt; title.replaceAll(&quot;[^a-zA-Z0-9]&quot;, &quot; &quot;))
                        .map(title -&gt; title.split(&quot; &quot;))
                        .flatMap(Arrays::stream)
        );

<span class="nc" id="L56">        stringStream.thenAccept(streamOfStrings -&gt; streamOfStrings.forEach(this::addToWordCount));</span>
<span class="nc" id="L57">    }</span>

    private void addToWordCount(String word){
<span class="nc bnc" id="L60" title="All 4 branches missed.">        if(word.length() != 0 &amp;&amp; wordCount.get(word) != null){</span>
<span class="nc" id="L61">            Integer currentCount = wordCount.get(word);</span>
<span class="nc" id="L62">            wordCount.put(word, currentCount+1);</span>
<span class="nc" id="L63">        }</span>
<span class="nc bnc" id="L64" title="All 4 branches missed.">        else if(word.length() != 0 &amp;&amp; wordCount.get(word) == null){</span>
<span class="nc" id="L65">            wordCount.put(word, 1);</span>
        }
<span class="nc" id="L67">    }</span>


    private HashMap&lt;String,Integer&gt; sortWordCount(){
<span class="nc" id="L71">        Set&lt;Map.Entry&lt;String, Integer&gt;&gt; set = wordCount.entrySet();</span>
<span class="nc" id="L72">        List&lt;Map.Entry&lt;String, Integer&gt;&gt; list = new ArrayList&lt;Map.Entry&lt;String, Integer&gt;&gt;(set);</span>
<span class="nc" id="L73">        list.sort(Map.Entry.comparingByValue(new Comparator&lt;Integer&gt;() {</span>
            @Override
            public int compare(Integer o1, Integer o2) {
<span class="nc" id="L76">                return o2.compareTo(o1);</span>
            }
        }));
<span class="nc" id="L79">        LinkedHashMap&lt;String, Integer&gt; map = new LinkedHashMap&lt;&gt;();</span>
<span class="nc bnc" id="L80" title="All 2 branches missed.">        for(int i = 0; i &lt; list.size(); i++){</span>
<span class="nc" id="L81">            map.put(list.get(i).getKey(), list.get(i).getValue());</span>
        }
<span class="nc" id="L83">        return map;</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>